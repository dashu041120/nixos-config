# ä¸ºä»€ä¹ˆéœ€è¦åˆ é™¤ modules/core/ ä¸­çš„å¤§éƒ¨åˆ†æ–‡ä»¶ï¼Ÿ

## æ ¸å¿ƒåŸå› ï¼šNixOS vs Nix åŒ…ç®¡ç†å™¨çš„æ ¹æœ¬å·®å¼‚

### ğŸ”´ **NixOS å’Œ Nix åŒ…ç®¡ç†å™¨æ˜¯ä¸¤ä¸ªå®Œå…¨ä¸åŒçš„ä¸œè¥¿**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     NixOS           â”‚         â”‚  Nix åŒ…ç®¡ç†å™¨ï¼ˆç‹¬ç«‹ï¼‰    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å®Œæ•´çš„ Linux å‘è¡Œç‰ˆ â”‚         â”‚ ä»…ä»…æ˜¯åŒ…ç®¡ç†å·¥å…·         â”‚
â”‚ å£°æ˜å¼ç³»ç»Ÿé…ç½®      â”‚         â”‚ åœ¨ç°æœ‰ OS ä¸Šè¿è¡Œ         â”‚
â”‚ ç®¡ç†æ‰€æœ‰ç³»ç»Ÿèµ„æº    â”‚         â”‚ åªç®¡ç†ç”¨æˆ·è½¯ä»¶åŒ…         â”‚
â”‚ ä¾‹ï¼šå¯åŠ¨å¼•å¯¼ç¨‹åº    â”‚         â”‚ ä¾‹ï¼šç¼–è¾‘å™¨ã€è¯­è¨€ç¯å¢ƒç­‰   â”‚
â”‚     ç¡¬ä»¶é©±åŠ¨        â”‚         â”‚                          â”‚
â”‚     ç³»ç»ŸæœåŠ¡        â”‚         â”‚ ä¸èƒ½ä¿®æ”¹ç³»ç»Ÿé…ç½®         â”‚
â”‚     ç½‘ç»œé…ç½®        â”‚         â”‚                          â”‚
â”‚     ç”¨æˆ·ç®¡ç†        â”‚         â”‚                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## è¯¦ç»†è§£é‡Šï¼šmodules/core/ ä¸­å„æ–‡ä»¶çš„é—®é¢˜

### 1ï¸âƒ£ **å¯åŠ¨å’Œç¡¬ä»¶ç›¸å…³ï¼ˆä¸å¯èƒ½åœ¨é NixOS ä¸Šä½¿ç”¨ï¼‰**

#### `bootloader.nix` - âŒ å¿…é¡»åˆ é™¤
```nix
boot.loader.grub.enable = true;
boot.loader.efi.canTouchEfiVariables = true;
boot.loader.timeout = 5;
```
- **ä¸ºä»€ä¹ˆä¸èƒ½ç”¨**ï¼š
  - ArchLinux/Debian å·²æœ‰è‡ªå·±çš„å¯åŠ¨åŠ è½½å™¨é…ç½®
  - NixOS çš„ `boot.loader` é€‰é¡¹åœ¨é NixOS ç³»ç»Ÿä¸Šä¸å­˜åœ¨
  - å¯åŠ¨åŠ è½½å™¨æ˜¯ç³»ç»Ÿçº§é…ç½®ï¼ŒNix åŒ…ç®¡ç†å™¨æ— æƒä¿®æ”¹
  - è¯•å›¾åº”ç”¨è¿™ä¸ªé…ç½®ä¼šå¯¼è‡´ home-manager æ„å»ºå¤±è´¥

#### `hardware.nix` - âŒ å¿…é¡»åˆ é™¤
```nix
hardware.enableRedistributableFirmware = true;
hardware.cpu.intel.updateMicrocode = true;
hardware.cpu.amd.updateMicrocode = true;
hardware.xone.enable = true;  # Xbox æ§åˆ¶å™¨é©±åŠ¨
```
- **ä¸ºä»€ä¹ˆä¸èƒ½ç”¨**ï¼š
  - è¿™äº›æ˜¯ NixOS å†…æ ¸çº§åˆ«çš„ç¡¬ä»¶é…ç½®
  - ArchLinux/Debian ä¸­ç”±ç³»ç»ŸåŒ…ç®¡ç†å™¨å’Œå†…æ ¸å¤„ç†
  - Nix åŒ…ç®¡ç†å™¨æ²¡æœ‰æƒé™ä¿®æ”¹å†…æ ¸å¾®ç æ›´æ–°
  - è¿™äº›é…ç½®é€‰é¡¹åœ¨ home-manager ä¸­ä¸å­˜åœ¨

---

### 2ï¸âƒ£ **æ˜¾ç¤ºæœåŠ¡å™¨å’Œæ¡Œé¢ç¯å¢ƒï¼ˆç³»ç»Ÿçº§æœåŠ¡ï¼‰**

#### `xserver.nix` - âŒ å¿…é¡»åˆ é™¤
```nix
services.xserver = {
  enable = true;
  displayManager.sddm.enable = true;
  desktopManager.kde.enable = true;
  videoDrivers = ["nvidia"];
}
```
- **ä¸ºä»€ä¹ˆä¸èƒ½ç”¨**ï¼š
  - X11 æœåŠ¡æ˜¯ç³»ç»Ÿçº§æœåŠ¡ï¼Œç”± systemd ç®¡ç†
  - ArchLinux/Debian é€šè¿‡ `systemctl` å¯åŠ¨ï¼Œä¸æ˜¯é€šè¿‡ NixOS é…ç½®
  - æ˜¾ç¤ºç®¡ç†å™¨ï¼ˆSDDMã€GDM ç­‰ï¼‰æ˜¯ç³»ç»Ÿçº§ï¼Œéœ€è¦ root æƒé™
  - æ˜¾å¡é©±åŠ¨é…ç½®æ˜¯å†…æ ¸çº§ï¼Œä¸æ˜¯ Nix åŒ…ç®¡ç†å™¨èƒ½å¤„ç†çš„
  - åœ¨é NixOS ä¸Šåº”ç”¨è¿™ä¸ªä¼šè¢«å®Œå…¨å¿½ç•¥æˆ–æŠ¥é”™

#### `wayland.nix` - âŒ å¿…é¡»åˆ é™¤
```nix
programs.sway.enable = true;
services.greetd.enable = true;
```
- **ä¸ºä»€ä¹ˆä¸èƒ½ç”¨**ï¼š
  - Wayland ä¼šè¯æ˜¯ç³»ç»Ÿçº§æœåŠ¡
  - éœ€è¦ç³»ç»Ÿçº§çš„ PAM é…ç½®ã€systemd ä¼šè¯ç­‰
  - Nix åŒ…ç®¡ç†å™¨æ— æ³•ä¿®æ”¹ç³»ç»Ÿçº§ PAM
  - ç”¨æˆ·çº§å¯ä»¥å®‰è£…ç›¸å…³å·¥å…·ï¼Œä½†ä¼šè¯å¯åŠ¨å¿…é¡»ç”±ç³»ç»Ÿå¤„ç†

#### `gnome.nix`, `kde.nix`, `cinnamon.nix`, `cosmic.nix` - âŒ å¿…é¡»åˆ é™¤
```nix
services.xserver.desktopManager.gnome.enable = true;
services.xserver.desktopManager.kde.enable = true;
```
- **ä¸ºä»€ä¹ˆä¸èƒ½ç”¨**ï¼š
  - æ‰€æœ‰æ¡Œé¢ç¯å¢ƒéƒ½æ˜¯é€šè¿‡ systemd å¯åŠ¨çš„ç³»ç»Ÿçº§æœåŠ¡
  - NixOS åœ¨å¯åŠ¨æ—¶æ³¨å†Œè¿™äº›æ¡Œé¢ç¯å¢ƒåˆ°æ˜¾ç¤ºç®¡ç†å™¨
  - ArchLinux/Debian å·²ç»é€šè¿‡ç³»ç»ŸåŒ…ç®¡ç†å™¨å®‰è£…å¹¶é…ç½®å¥½äº†è¿™äº›
  - å†é€šè¿‡ Nix é…ç½®å®ƒä»¬ä¼šäº§ç”Ÿå†²çª

---

### 3ï¸âƒ£ **ç³»ç»ŸæœåŠ¡å’ŒéŸ³é¢‘ï¼ˆsystemd æœåŠ¡ï¼‰**

#### `pipewire.nix` - âŒ å¿…é¡»åˆ é™¤
```nix
services.pipewire.enable = true;
services.pipewire.alsa.enable = true;
services.pipewire.pulse.enable = true;
```
- **ä¸ºä»€ä¹ˆä¸èƒ½ç”¨**ï¼š
  - PipeWire æ˜¯é€šè¿‡ systemd ç”¨æˆ·æœåŠ¡å¯åŠ¨çš„
  - NixOS ç®¡ç†ç³»ç»Ÿçº§ systemd å•å…ƒ
  - ArchLinux/Debian çš„ systemd ç”±ç³»ç»ŸåŒ…ç®¡ç†å™¨æ§åˆ¶ï¼Œä¸æ˜¯ Nix
  - ç”¨æˆ·çº§ PipeWire é…ç½®å¯ä»¥åœ¨ home-manager ä¸­å¤„ç†ï¼Œä½†å¯åŠ¨å¿…é¡»ç”±ç³»ç»Ÿå¤„ç†

#### `bluetooth.nix` - âŒ å¿…é¡»åˆ é™¤
```nix
hardware.bluetooth.enable = true;
services.blueman.enable = true;
```
- **ä¸ºä»€ä¹ˆä¸èƒ½ç”¨**ï¼š
  - è“ç‰™æ˜¯ç¡¬ä»¶æœåŠ¡ï¼Œéœ€è¦ç³»ç»Ÿçº§ dbus é…ç½®
  - ArchLinux/Debian å·²é€šè¿‡ç³»ç»ŸåŒ…ç®¡ç†å™¨å¯ç”¨
  - Nix åŒ…ç®¡ç†å™¨æ— æ³•å¯åŠ¨æˆ–åœæ­¢ç³»ç»ŸæœåŠ¡

---

### 4ï¸âƒ£ **ç½‘ç»œé…ç½®ï¼ˆç³»ç»Ÿçº§ç½‘ç»œæ ˆï¼‰**

#### `network.nix` - âŒ å¿…é¡»åˆ é™¤
```nix
networking.networkmanager.enable = true;
networking.hostName = "dashu-rog16";
hardware.enableRedistributableFirmware = true;
```
- **ä¸ºä»€ä¹ˆä¸èƒ½ç”¨**ï¼š
  - NetworkManager æ˜¯ç³»ç»Ÿçº§æœåŠ¡
  - ä¸»æœºåè®¾ç½®æ˜¯å†…æ ¸/ç³»ç»Ÿé…ç½®
  - å›ºä»¶åŠ è½½æ˜¯å¯åŠ¨æ—¶çš„å†…æ ¸å·¥ä½œ
  - ç”¨æˆ·çº§ç½‘ç»œç®¡ç†å·¥å…·ï¼ˆå¦‚ nmcliï¼‰å¯ä»¥é€šè¿‡ home-manager å®‰è£…
  - ä½†æœåŠ¡å¯åŠ¨å’Œç³»ç»Ÿé…ç½®å¿…é¡»ç”±ç³»ç»Ÿå¤„ç†

#### `net-forwarding.nix` - âŒ å¿…é¡»åˆ é™¤
```nix
boot.kernel.sysctl."net.ipv4.ip_forward" = 1;
```
- **ä¸ºä»€ä¹ˆä¸èƒ½ç”¨**ï¼š
  - å†…æ ¸å‚æ•°å¿…é¡»åœ¨å¯åŠ¨æ—¶è®¾ç½®
  - éœ€è¦ root æƒé™ä¸”æ˜¯ç³»ç»Ÿçº§é…ç½®
  - åœ¨é NixOS ä¸Šæ— æ³•é€šè¿‡ Nix åŒ…ç®¡ç†å™¨ä¿®æ”¹

---

### 5ï¸âƒ£ **æ˜¾ç¤ºç®¡ç†å™¨ï¼ˆsystemd é›†æˆï¼‰**

#### `sddm.nix` - âŒ å¿…é¡»åˆ é™¤
```nix
services.xserver.displayManager.sddm.enable = true;
services.xserver.displayManager.sddm.theme = "astronaut";
```
- **ä¸ºä»€ä¹ˆä¸èƒ½ç”¨**ï¼š
  - æ˜¾ç¤ºç®¡ç†å™¨æ˜¯ç³»ç»Ÿçº§æœåŠ¡
  - éœ€è¦ç³»ç»Ÿçº§ systemd é…ç½®
  - ArchLinux/Debian ç”±ç³»ç»Ÿ systemd å¯åŠ¨
  - Nix åŒ…ç®¡ç†å™¨æ— æ³•å¯ç”¨æˆ–é…ç½®ç³»ç»ŸæœåŠ¡

---

### 6ï¸âƒ£ **å®‰å…¨å’Œç”¨æˆ·ç®¡ç†**

#### `security.nix` - âŒ å¿…é¡»åˆ é™¤
```nix
security.rtkit.enable = true;
security.sudo.enable = true;
security.pam.services.swaylock = { };
```
- **ä¸ºä»€ä¹ˆä¸èƒ½ç”¨**ï¼š
  - PAMï¼ˆå¯æ’å…¥è®¤è¯æ¨¡å—ï¼‰æ˜¯ç³»ç»Ÿçº§å®‰å…¨æ¡†æ¶
  - rtkit æ˜¯ç³»ç»Ÿçº§æœåŠ¡
  - sudo é…ç½®æ˜¯ç³»ç»Ÿçº§
  - è¿™äº›éƒ½åœ¨é NixOS ç³»ç»Ÿä¸Šç”±ç³»ç»ŸåŒ…ç®¡ç†å™¨ç®¡ç†
  - Nix åŒ…ç®¡ç†å™¨æ²¡æœ‰æƒé™ä¿®æ”¹ PAM æˆ–å®‰å…¨æ¡†æ¶

#### `user.nix` - âŒ å¿…é¡»åˆ é™¤
```nix
users.users.${username} = {
  isNormalUser = true;
  extraGroups = ["networkmanager" "wheel" "docker"];
  shell = pkgs.zsh;
};
```
- **ä¸ºä»€ä¹ˆä¸èƒ½ç”¨**ï¼š
  - ç”¨æˆ·è´¦æˆ·æ˜¯ç³»ç»Ÿçº§èµ„æºï¼Œç”± `/etc/passwd` å’Œ `/etc/shadow` ç®¡ç†
  - ç»„å…³ç³»ç”± `/etc/group` ç®¡ç†ï¼Œéœ€è¦ root æƒé™
  - ArchLinux/Debian çš„ç”¨æˆ·å·²åœ¨ç³»ç»Ÿä¸Šåˆ›å»º
  - Nix åŒ…ç®¡ç†å™¨ä½œä¸ºæ™®é€šç”¨æˆ·è¿è¡Œï¼Œæ— æ³•ä¿®æ”¹ç”¨æˆ·/ç»„
  - é»˜è®¤ shell åº”è¯¥ç”±ç³»ç»Ÿé…ç½®ï¼Œä¸æ˜¯ Nix

---

### 7ï¸âƒ£ **è™šæ‹ŸåŒ–ï¼ˆç³»ç»Ÿçº§è™šæ‹ŸåŒ–æ¡†æ¶ï¼‰**

#### `virtualization.nix` - âŒ å¿…é¡»åˆ é™¤
```nix
virtualisation.libvirtd.enable = true;
virtualisation.docker.enable = true;
virtualisation.kvm.enable = true;
```
- **ä¸ºä»€ä¹ˆä¸èƒ½ç”¨**ï¼š
  - è™šæ‹ŸåŒ–éœ€è¦å†…æ ¸æ¨¡å—ï¼ˆåŠ è½½éœ€è¦ rootï¼‰
  - è™šæ‹ŸåŒ–å®ˆæŠ¤ç¨‹åºæ˜¯ç³»ç»Ÿçº§æœåŠ¡
  - ç”¨æˆ·ç»„ (libvirt, docker) éœ€è¦ç³»ç»Ÿçº§é…ç½®
  - ArchLinux/Debian é€šè¿‡ç³»ç»ŸåŒ…ç®¡ç†å™¨ç®¡ç†è™šæ‹ŸåŒ–
  - è™šæ‹ŸåŒ–å·¥å…·æœ¬èº«å¯ä»¥é€šè¿‡ home-manager å®‰è£…ï¼Œä½†è¿è¡Œæ—¶éœ€è¦ç³»ç»ŸæœåŠ¡

---

### 8ï¸âƒ£ **åƒåœ¾å›æ”¶å’Œç³»ç»Ÿä¼˜åŒ–**

#### `garbage_clean.nix` - âš ï¸ éƒ¨åˆ†å¯ä»¥ä¿ç•™
```nix
nix.gc.enable = true;                           # âŒ ç³»ç»Ÿçº§å®šæ—¶ä»»åŠ¡
nix.gc.dates = "weekly";
nix.gc.options = "--delete-older-than 30d";

nix.optimise-store.enable = true;               # âŒ ç³»ç»Ÿçº§å®šæ—¶ä»»åŠ¡
nix.optimise-store.dates = ["03:45"];
```
- **ä¸ºä»€ä¹ˆä¸èƒ½ç”¨**ï¼š
  - `nix.gc.enable` å’Œ `nix.optimise-store.enable` æ˜¯ NixOS systemd å®šæ—¶å•å…ƒ
  - åœ¨é NixOS ä¸Šï¼Œè¿™äº›é€‰é¡¹æ ¹æœ¬ä¸å­˜åœ¨
  - ç”¨æˆ·å¯ä»¥æ‰‹åŠ¨è¿è¡Œ `nix-collect-garbage` å’Œ `nix store optimize`
  - å¯ä»¥åœ¨ç”¨æˆ· crontab æˆ– systemd ç”¨æˆ·å®šæ—¶å™¨ä¸­å®ç°

---

### 9ï¸âƒ£ **æ¸¸æˆå’Œç¨‹åºé…ç½®**

#### `game.nix` - âš ï¸ éœ€è¦æ£€æŸ¥
```nix
imports = with nix-gaming.nixosModules; [ ... ];
```
- **ä¸ºä»€ä¹ˆå¯èƒ½ä¸èƒ½ç”¨**ï¼š
  - å¦‚æœå¯¼å…¥çš„æ˜¯ `nix-gaming.nixosModules`ï¼Œè¿™äº›æ˜¯ NixOS ç‰¹å®šçš„
  - å¦‚æœä½¿ç”¨çš„æ˜¯ `nix-gaming` ä¸­çš„ç”¨æˆ·çº§åŒ…ï¼Œé‚£ä¹ˆå¯ä»¥ä¿ç•™
  - éœ€è¦æ£€æŸ¥å…·ä½“å†…å®¹

#### `programs.nix` - âš ï¸ éœ€è¦æ£€æŸ¥
- **ä¸ºä»€ä¹ˆå¯èƒ½ä¸èƒ½ç”¨**ï¼š
  - å¦‚æœé…ç½®çš„æ˜¯ç³»ç»Ÿçº§ç¨‹åºï¼ˆä¾‹å¦‚ `programs.firefox.enable = true`ï¼‰ï¼Œéœ€è¦åˆ é™¤
  - å¦‚æœåªæ˜¯å®‰è£…ç”¨æˆ·çº§å·¥å…·ï¼Œå¯ä»¥è½¬ç§»åˆ° home-manager

---

## âœ… ä¿ç•™çš„éƒ¨åˆ†ï¼šä¸ºä»€ä¹ˆ modules/home/ å®Œå…¨å…¼å®¹ï¼Ÿ

```nix
# modules/home/alacritty.nix - âœ… å¯ä»¥ä¿ç•™
programs.alacritty = {
  enable = true;
  settings = { ... };  # ç”¨æˆ·çº§é…ç½®æ–‡ä»¶
};

# modules/home/zsh.nix - âœ… å¯ä»¥ä¿ç•™
programs.zsh = {
  enable = true;
  plugins = [ ... ];   # ç”¨æˆ·çº§ shell é…ç½®
};

# modules/home/fcitx5/ - âœ… å¯ä»¥ä¿ç•™
home.file.".config/fcitx5/" = {
  source = ./fcitx5/configs;  # ç”¨æˆ·çº§é…ç½®æ–‡ä»¶
};
```

**ä¸ºä»€ä¹ˆè¿™äº›å¯ä»¥ä¿ç•™ï¼š**
1. å®ƒä»¬é…ç½®çš„éƒ½æ˜¯ç”¨æˆ·çº§åº”ç”¨ç¨‹åº
2. ç”Ÿæˆçš„é…ç½®æ–‡ä»¶å­˜å‚¨åœ¨ `~/.config` ç­‰ç”¨æˆ·ç›®å½•ä¸­
3. ä¸æ¶‰åŠå†…æ ¸ã€é©±åŠ¨ã€ç³»ç»ŸæœåŠ¡æˆ–æƒé™æå‡
4. home-manager å®Œå…¨æ˜¯ä¸ºç”¨æˆ·çº§é…ç½®è®¾è®¡çš„

---

## ğŸ¯ æ€»ç»“ï¼šNixOS ç³»ç»Ÿé…ç½® vs ç”¨æˆ·é…ç½®

| å±‚çº§ | é…ç½®èŒƒå›´ | NixOS å·¥å…· | Nix ç‹¬ç«‹ | ä¾‹å­ |
|------|--------|-----------|--------|------|
| **ç³»ç»Ÿçº§** | å†…æ ¸ã€é©±åŠ¨ã€å¯åŠ¨ã€ç³»ç»ŸæœåŠ¡ | âœ… nixos-rebuild | âŒ ä¸æ”¯æŒ | bootloader, hardware, services |
| **ç”¨æˆ·çº§** | åº”ç”¨é…ç½®ã€è¯­è¨€ç¯å¢ƒã€å¼€å‘å·¥å…· | âœ… home-manager | âœ… home-manager | alacritty, zsh, vscode é…ç½® |

---

## ä¸ºä»€ä¹ˆè¦åˆ é™¤è€Œä¸æ˜¯æ³¨é‡Šæ‰ï¼Ÿ

### åŸå›  1ï¼šé…ç½®è¯„ä¼°ä¼šå¤±è´¥
```nix
# å³ä½¿æ³¨é‡Šæ‰ï¼Œåªè¦åœ¨ modules/core/default.nix ä¸­ importï¼Œ
# Nix è¯„ä¼°å™¨ä¹Ÿä¼šè§£æå®ƒ
imports = [
  ./bootloader.nix    # â† å³ä½¿è¿™è¡Œè¢«æ³¨é‡Šï¼Œæ–‡ä»¶ä¸­çš„é”™è¯¯ä»ä¼šè¢«æ£€æŸ¥
];
```

### åŸå›  2ï¼šæ›´æ¸…æ™°çš„ç»“æ„
- åˆ é™¤ä¸éœ€è¦çš„æ–‡ä»¶ï¼Œä½¿é…ç½®æ„å›¾æ›´æ˜ç¡®
- æ–°ç”¨æˆ·ä¸ä¼šçœ‹åˆ°ä»–ä»¬æ— æ³•ä½¿ç”¨çš„é…ç½®é€‰é¡¹
- å‡å°‘æ··æ·†

### åŸå›  3ï¼šé¿å…é€‰é¡¹é”™è¯¯
```
Error: The option `boot.loader.systemd-boot' does not exist.
       in /nix/store/.../modules/core/bootloader.nix:33
```
å³ä½¿ä»£ç æ­£ç¡®ï¼Œåœ¨é NixOS ä¸Šè¿™ä¸ªé€‰é¡¹å°±æ˜¯ä¸å­˜åœ¨çš„ã€‚

---

## ğŸš€ è¿ç§»åçš„ modules/core/ åº”è¯¥çœ‹èµ·æ¥åƒè¿™æ ·

```nix
# modules/core/default.nix
{ ... }:
{
  imports = [
    ./system.nix        # åªä¿ç•™è¿™ä¸ª
  ];
}
```

```nix
# modules/core/system.nix - é‡å†™ä¸º
{ pkgs, inputs, ... }:
{
  # åªä¿ç•™ Nix è‡ªèº«çš„é…ç½®ï¼Œä¸æ¶‰åŠç³»ç»Ÿçº§æ“ä½œ
  nix = {
    settings = {
      auto-optimise-store = true;
      experimental-features = ["nix-command" "flakes"];
      substituters = [ ... ];
      trusted-public-keys = [ ... ];
    };
  };

  nixpkgs = {
    overlays = [ inputs.nur.overlays.default ];
    config.allowUnfree = true;
  };

  # âŒ åˆ é™¤ environment.systemPackagesï¼ˆç³»ç»Ÿçº§ï¼‰
  # âœ… æ”¹ä¸ºé€šè¿‡ home-manager å®‰è£…ç”¨æˆ·åŒ…
}
```

---

## å…³é”®åŒºåˆ«æ€»ç»“

```
NixOS æ¨¡å¼ï¼š
é…ç½®æ–‡ä»¶ â†’ NixOS è¯„ä¼°å™¨ â†’ ç³»ç»Ÿçº§é…ç½® â†’ åº”ç”¨åˆ°æ•´ä¸ªç³»ç»Ÿ
   â†“                                          â†“
/etc/nixos/configuration.nix      ç³»ç»Ÿå¯åŠ¨æ—¶åº”ç”¨

---

Nix ç‹¬ç«‹æ¨¡å¼ï¼š
é…ç½®æ–‡ä»¶ â†’ home-manager è¯„ä¼°å™¨ â†’ ç”¨æˆ·çº§é…ç½® â†’ åº”ç”¨åˆ°ç”¨æˆ·ä¸»ç›®å½•
   â†“                                            â†“
~/.config/home-manager/...      ç”¨æˆ·è¿è¡Œ home-manager switch æ—¶åº”ç”¨
```

ä½ çš„ç³»ç»Ÿï¼ˆArchLinux/Debianï¼‰å·²ç»æ˜¯ä¸€ä¸ªå®Œæ•´çš„ã€é…ç½®å¥½çš„ Linux å‘è¡Œç‰ˆã€‚
Nix åªæ˜¯åœ¨å…¶ä¸Šå±‚æ·»åŠ ç”¨æˆ·çº§åŒ…ç®¡ç†ï¼Œè€Œä¸æ˜¯é‡æ–°é…ç½®æ•´ä¸ªç³»ç»Ÿã€‚

è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå¿…é¡»åˆ é™¤ `modules/core/` ä¸­çš„ç»å¤§éƒ¨åˆ†æ–‡ä»¶ã€‚
